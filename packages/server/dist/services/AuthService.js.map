{
  "version": 3,
  "sources": ["../../../../src/server/services/AuthService.ts"],
  "sourcesContent": ["import bcrypt from \"bcryptjs\";\nimport { User } from \"../models/User\";\nimport { Logger } from \"../utils/Logger\";\nimport { PlayerUtils } from \"../utils/PlayerUtils\";\nimport { Theme } from \"../config/AdminLevels\";\n\nexport class AuthService {\n    static async register(player: PlayerMp, username: string, pass: string) {\n        try {\n            if (pass.length < 6) {\n                return player.outputChatBox(`${Theme.Error}Securitate: ${Theme.Text}Parola este prea scurta (minim 6 caractere).`);\n            }\n\n            const existing = await User.findOneBy({ username });\n            if (existing) {\n                return player.outputChatBox(`${Theme.Error}Eroare: ${Theme.Text}Acest cont este deja inregistrat.`);\n            }\n\n            const hashed = await bcrypt.hash(pass, 10);\n            const userCount = await User.count();\n            \n            const newUser = new User();\n            newUser.username = username;\n            newUser.password = hashed;\n            newUser.adminLevel = userCount === 0 ? 5 : 0;\n            \n            await newUser.save();\n            player.outputChatBox(`${Theme.Success}Succes: ${Theme.Text}Contul tau a fost creat. Te rugam sa folosesti ${Theme.Primary}/login <parola>`);\n            Logger.info(`[AUTH] Utilizator nou: ${username}`);\n        } catch (e) {\n            Logger.error(\"Eroare inregistrare:\", (e as any).message);\n        }\n    }\n\n    static async login(player: PlayerMp, username: string, pass: string) {\n        try {\n            if (PlayerUtils.getDb(player)) {\n                return player.outputChatBox(`${Theme.Error}Sistem: ${Theme.Text}Esti deja autentificat.`);\n            }\n\n            const user = await User.findOneBy({ username });\n            if (!user) {\n                return player.outputChatBox(`${Theme.Error}Eroare: ${Theme.Text}Numele de utilizator nu este valid.`);\n            }\n\n            if (user.isBanned) {\n                player.outputChatBox(`${Theme.Error}RESTRIC\u021AIONAT: ${Theme.Text}Acces interzis. Motiv: ${Theme.Primary}${user.banReason}`);\n                return player.kick(\"Banned\");\n            }\n\n            const match = await bcrypt.compare(pass, user.password);\n            if (!match) {\n                return player.outputChatBox(`${Theme.Error}Eroare: ${Theme.Text}Parola introdusa este incorecta.`);\n            }\n\n            PlayerUtils.setDb(player, user);\n            player.name = user.username;\n            \n            const pos = JSON.parse(user.lastPos);\n            player.spawn(new mp.Vector3(pos.x, pos.y, pos.z));\n            player.dimension = user.dimension;\n            player.health = user.health;\n            player.armour = user.armor;\n\n            player.outputChatBox(`${Theme.Success}Sistem: ${Theme.Text}Autentificare reusita. Bun venit, ${Theme.Primary}${username}!`);\n            Logger.info(`[AUTH] ${username} s-a autentificat.`);\n        } catch (e) {\n            Logger.error(\"Eroare login:\", (e as any).message);\n        }\n    }\n\n    static async savePlayer(player: PlayerMp) {\n        const user = PlayerUtils.getDb(player);\n        if (!user || !mp.players.exists(player)) return;\n\n        user.health = player.health;\n        user.armor = player.armour;\n        user.dimension = player.dimension;\n        user.lastPos = JSON.stringify({ x: player.position.x, y: player.position.y, z: player.position.z });\n        \n        try {\n            await user.save();\n        } catch (e) {\n            Logger.error(`Eroare salvare ${user.username}:`, (e as any).message);\n        }\n    }\n}\n"],
  "mappings": "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",
  "names": ["bcrypt"]
}
