{
  "version": 3,
  "sources": ["../../../../src/server/services/AuthService.ts"],
  "sourcesContent": ["import bcrypt from \"bcryptjs\";\nimport { User } from \"../models/User\";\nimport { Logger } from \"../utils/Logger\";\nimport { PlayerUtils } from \"../utils/PlayerUtils\";\n\nexport class AuthService {\n    static async register(player: PlayerMp, username: string, pass: string) {\n        try {\n            if (pass.length < 4) {\n                return player.outputChatBox(\"!{#FF0000}Eroare: !{#FFFFFF}Parola trebuie sa aiba minim 4 caractere.\");\n            }\n\n            const existing = await User.findOneBy({ username });\n            if (existing) {\n                return player.outputChatBox(\"!{#FF0000}Eroare: !{#FFFFFF}Acest nume este deja utilizat.\");\n            }\n\n            const hashed = await bcrypt.hash(pass, 10);\n            const userCount = await User.count();\n            \n            const newUser = new User();\n            newUser.username = username;\n            newUser.password = hashed;\n            newUser.adminLevel = userCount === 0 ? 5 : 0; // Primul utilizator primeste Owner automat\n            \n            await newUser.save();\n            player.outputChatBox(\"!{#00FF00}Succes: !{#FFFFFF}Cont creat cu succes! Te poti loga.\");\n            Logger.info(`[AUTH] ${username} s-a inregistrat.`);\n        } catch (e) {\n            Logger.error(\"Eroare la inregistrare:\", (e as any).message);\n        }\n    }\n\n    static async login(player: PlayerMp, username: string, pass: string) {\n        try {\n            if (PlayerUtils.getDb(player)) {\n                return player.outputChatBox(\"!{#FF0000}Eroare: !{#FFFFFF}Esti deja logat.\");\n            }\n\n            const user = await User.findOneBy({ username });\n            if (!user) {\n                return player.outputChatBox(\"!{#FF0000}Eroare: !{#FFFFFF}Contul nu exista.\");\n            }\n\n            if (user.isBanned) {\n                return player.outputChatBox(`!{#FF0000}Esti banat pe acest server! Motiv: ${user.banReason}`);\n            }\n\n            const match = await bcrypt.compare(pass, user.password);\n            if (!match) {\n                return player.outputChatBox(\"!{#FF0000}Eroare: !{#FFFFFF}Parola este incorecta.\");\n            }\n\n            // Atasam datele jucatorului\n            PlayerUtils.setDb(player, user);\n            player.name = user.username;\n            \n            // Spawn & Stat load\n            const pos = JSON.parse(user.lastPos);\n            player.spawn(new mp.Vector3(pos.x, pos.y, pos.z));\n            player.dimension = user.dimension;\n            player.health = user.health;\n            player.armour = user.armor;\n\n            player.outputChatBox(`!{#00FF00}Bine ai revenit, !{#FFFFFF}${username}!`);\n            player.outputChatBox(`!{#FFFF00}Stats: !{#FFFFFF}Level ${user.level} | Bani: $${user.money.toLocaleString()}`);\n            \n            Logger.info(`[AUTH] ${username} s-a logat.`);\n        } catch (e) {\n            Logger.error(\"Eroare la login:\", (e as any).message);\n        }\n    }\n\n    static async savePlayer(player: PlayerMp) {\n        const user = PlayerUtils.getDb(player);\n        if (!user || !mp.players.exists(player)) return;\n\n        user.health = player.health;\n        user.armor = player.armour;\n        user.dimension = player.dimension;\n        user.lastPos = JSON.stringify({ x: player.position.x, y: player.position.y, z: player.position.z });\n        \n        try {\n            await user.save();\n        } catch (e) {\n            Logger.error(`Eroare la salvarea lui ${user.username}:`, (e as any).message);\n        }\n    }\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAmB;AACnB,kBAAqB;AACrB,oBAAuB;AACvB,yBAA4B;AAErB,MAAM,YAAY;AAAA,EACrB,aAAa,SAAS,QAAkB,UAAkB,MAAc;AACpE,QAAI;AACA,UAAI,KAAK,SAAS,GAAG;AACjB,eAAO,OAAO,cAAc,uEAAuE;AAAA,MACvG;AAEA,YAAM,WAAW,MAAM,iBAAK,UAAU,EAAE,SAAS,CAAC;AAClD,UAAI,UAAU;AACV,eAAO,OAAO,cAAc,4DAA4D;AAAA,MAC5F;AAEA,YAAM,SAAS,MAAM,gBAAAA,QAAO,KAAK,MAAM,EAAE;AACzC,YAAM,YAAY,MAAM,iBAAK,MAAM;AAEnC,YAAM,UAAU,IAAI,iBAAK;AACzB,cAAQ,WAAW;AACnB,cAAQ,WAAW;AACnB,cAAQ,aAAa,cAAc,IAAI,IAAI;AAE3C,YAAM,QAAQ,KAAK;AACnB,aAAO,cAAc,iEAAiE;AACtF,2BAAO,KAAK,UAAU,QAAQ,mBAAmB;AAAA,IACrD,SAAS,GAAG;AACR,2BAAO,MAAM,2BAA4B,EAAU,OAAO;AAAA,IAC9D;AAAA,EACJ;AAAA,EAEA,aAAa,MAAM,QAAkB,UAAkB,MAAc;AACjE,QAAI;AACA,UAAI,+BAAY,MAAM,MAAM,GAAG;AAC3B,eAAO,OAAO,cAAc,8CAA8C;AAAA,MAC9E;AAEA,YAAM,OAAO,MAAM,iBAAK,UAAU,EAAE,SAAS,CAAC;AAC9C,UAAI,CAAC,MAAM;AACP,eAAO,OAAO,cAAc,+CAA+C;AAAA,MAC/E;AAEA,UAAI,KAAK,UAAU;AACf,eAAO,OAAO,cAAc,gDAAgD,KAAK,SAAS,EAAE;AAAA,MAChG;AAEA,YAAM,QAAQ,MAAM,gBAAAA,QAAO,QAAQ,MAAM,KAAK,QAAQ;AACtD,UAAI,CAAC,OAAO;AACR,eAAO,OAAO,cAAc,oDAAoD;AAAA,MACpF;AAGA,qCAAY,MAAM,QAAQ,IAAI;AAC9B,aAAO,OAAO,KAAK;AAGnB,YAAM,MAAM,KAAK,MAAM,KAAK,OAAO;AACnC,aAAO,MAAM,IAAI,GAAG,QAAQ,IAAI,GAAG,IAAI,GAAG,IAAI,CAAC,CAAC;AAChD,aAAO,YAAY,KAAK;AACxB,aAAO,SAAS,KAAK;AACrB,aAAO,SAAS,KAAK;AAErB,aAAO,cAAc,wCAAwC,QAAQ,GAAG;AACxE,aAAO,cAAc,oCAAoC,KAAK,KAAK,aAAa,KAAK,MAAM,eAAe,CAAC,EAAE;AAE7G,2BAAO,KAAK,UAAU,QAAQ,aAAa;AAAA,IAC/C,SAAS,GAAG;AACR,2BAAO,MAAM,oBAAqB,EAAU,OAAO;AAAA,IACvD;AAAA,EACJ;AAAA,EAEA,aAAa,WAAW,QAAkB;AACtC,UAAM,OAAO,+BAAY,MAAM,MAAM;AACrC,QAAI,CAAC,QAAQ,CAAC,GAAG,QAAQ,OAAO,MAAM,EAAG;AAEzC,SAAK,SAAS,OAAO;AACrB,SAAK,QAAQ,OAAO;AACpB,SAAK,YAAY,OAAO;AACxB,SAAK,UAAU,KAAK,UAAU,EAAE,GAAG,OAAO,SAAS,GAAG,GAAG,OAAO,SAAS,GAAG,GAAG,OAAO,SAAS,EAAE,CAAC;AAElG,QAAI;AACA,YAAM,KAAK,KAAK;AAAA,IACpB,SAAS,GAAG;AACR,2BAAO,MAAM,0BAA0B,KAAK,QAAQ,KAAM,EAAU,OAAO;AAAA,IAC/E;AAAA,EACJ;AACJ;",
  "names": ["bcrypt"]
}
