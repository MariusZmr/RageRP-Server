{
  "version": 3,
  "sources": ["../../../../src/server/commands/CommandManager.ts"],
  "sourcesContent": ["import fs from \"fs\";\nimport path from \"path\";\nimport { Logger } from \"../utils/Logger\";\nimport { findCommand, getAllCommands } from \"./CommandRegistry\";\nimport { PlayerUtils } from \"../utils/PlayerUtils\";\nimport { Theme } from \"../config/AdminLevels\";\n\nexport class CommandManager {\n    static async loadCommands() {\n        const commandsPath = __dirname;\n        this.readDirRecursive(commandsPath);\n        \n        const commands = getAllCommands();\n        Logger.info(`[CMD] Sistem Enterprise activat. ${commands.length} comenzi incarcate.`);\n    }\n\n    private static readDirRecursive(dir: string) {\n        const items = fs.readdirSync(dir);\n\n        for (const item of items) {\n            const fullPath = path.join(dir, item);\n            const stats = fs.statSync(fullPath);\n\n            if (stats.isDirectory()) {\n                // Set\u0103m categoria global\u0103 ca fiind numele folderului curent\n                (global as any).currentLoadingCategory = item.toLowerCase();\n                this.readDirRecursive(fullPath);\n                (global as any).currentLoadingCategory = undefined; // Reset\u0103m dup\u0103 ie\u0219ire\n            } else if (item.endsWith(\".js\") && !item.includes(\"CommandManager\") && !item.includes(\"CommandRegistry\")) {\n                try {\n                    delete require.cache[require.resolve(fullPath)];\n                    require(fullPath);\n                } catch (e) {\n                    Logger.error(`Eroare la incarcarea modulului ${item}:`, (e as any).message);\n                }\n            }\n        }\n    }\n\n    static handleCommand(player: PlayerMp, message: string) {\n        const args = message.split(\" \");\n        const trigger = args.shift()?.toLowerCase();\n        if (!trigger) return;\n\n        const cmd = findCommand(trigger);\n        if (!cmd) {\n            player.outputChatBox(`${Theme.Error}Eroare: ${Theme.Text}Comanda ${Theme.Primary}/${trigger}${Theme.Text} nu exista. Foloseste ${Theme.Primary}/help.`);\n            return;\n        }\n\n        const user = PlayerUtils.getDb(player);\n        if (!user && cmd.name !== \"login\" && cmd.name !== \"register\") {\n            player.outputChatBox(`${Theme.Error}Sistem: ${Theme.Text}Autentificarea este obligatorie.`);\n            return;\n        }\n\n        if (cmd.minAdmin && (!user || user.adminLevel < cmd.minAdmin)) {\n            player.outputChatBox(`${Theme.Error}Securitate: ${Theme.Text}Nivel de acces insuficient.`);\n            return;\n        }\n\n        try {\n            cmd.execute(player, args, args.join(\" \"));\n        } catch (e) {\n            Logger.error(`Eroare executie /${cmd.name}:`, (e as any).stack);\n            player.outputChatBox(`${Theme.Error}Eroare: ${Theme.Text}Procesare esuata.`);\n        }\n    }\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAAe;AACf,kBAAiB;AACjB,oBAAuB;AACvB,6BAA4C;AAC5C,yBAA4B;AAC5B,yBAAsB;AAEf,MAAM,eAAe;AAAA,EACxB,aAAa,eAAe;AACxB,UAAM,eAAe;AACrB,SAAK,iBAAiB,YAAY;AAElC,UAAM,eAAW,uCAAe;AAChC,yBAAO,KAAK,oCAAoC,SAAS,MAAM,qBAAqB;AAAA,EACxF;AAAA,EAEA,OAAe,iBAAiB,KAAa;AACzC,UAAM,QAAQ,UAAAA,QAAG,YAAY,GAAG;AAEhC,eAAW,QAAQ,OAAO;AACtB,YAAM,WAAW,YAAAC,QAAK,KAAK,KAAK,IAAI;AACpC,YAAM,QAAQ,UAAAD,QAAG,SAAS,QAAQ;AAElC,UAAI,MAAM,YAAY,GAAG;AAErB,QAAC,OAAe,yBAAyB,KAAK,YAAY;AAC1D,aAAK,iBAAiB,QAAQ;AAC9B,QAAC,OAAe,yBAAyB;AAAA,MAC7C,WAAW,KAAK,SAAS,KAAK,KAAK,CAAC,KAAK,SAAS,gBAAgB,KAAK,CAAC,KAAK,SAAS,iBAAiB,GAAG;AACtG,YAAI;AACA,iBAAO,QAAQ,MAAM,QAAQ,QAAQ,QAAQ,CAAC;AAC9C,kBAAQ,QAAQ;AAAA,QACpB,SAAS,GAAG;AACR,+BAAO,MAAM,kCAAkC,IAAI,KAAM,EAAU,OAAO;AAAA,QAC9E;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAAA,EAEA,OAAO,cAAc,QAAkB,SAAiB;AAvC5D;AAwCQ,UAAM,OAAO,QAAQ,MAAM,GAAG;AAC9B,UAAM,WAAU,UAAK,MAAM,MAAX,mBAAc;AAC9B,QAAI,CAAC,QAAS;AAEd,UAAM,UAAM,oCAAY,OAAO;AAC/B,QAAI,CAAC,KAAK;AACN,aAAO,cAAc,GAAG,yBAAM,KAAK,WAAW,yBAAM,IAAI,WAAW,yBAAM,OAAO,IAAI,OAAO,GAAG,yBAAM,IAAI,yBAAyB,yBAAM,OAAO,QAAQ;AACtJ;AAAA,IACJ;AAEA,UAAM,OAAO,+BAAY,MAAM,MAAM;AACrC,QAAI,CAAC,QAAQ,IAAI,SAAS,WAAW,IAAI,SAAS,YAAY;AAC1D,aAAO,cAAc,GAAG,yBAAM,KAAK,WAAW,yBAAM,IAAI,kCAAkC;AAC1F;AAAA,IACJ;AAEA,QAAI,IAAI,aAAa,CAAC,QAAQ,KAAK,aAAa,IAAI,WAAW;AAC3D,aAAO,cAAc,GAAG,yBAAM,KAAK,eAAe,yBAAM,IAAI,6BAA6B;AACzF;AAAA,IACJ;AAEA,QAAI;AACA,UAAI,QAAQ,QAAQ,MAAM,KAAK,KAAK,GAAG,CAAC;AAAA,IAC5C,SAAS,GAAG;AACR,2BAAO,MAAM,oBAAoB,IAAI,IAAI,KAAM,EAAU,KAAK;AAC9D,aAAO,cAAc,GAAG,yBAAM,KAAK,WAAW,yBAAM,IAAI,mBAAmB;AAAA,IAC/E;AAAA,EACJ;AACJ;",
  "names": ["fs", "path"]
}
